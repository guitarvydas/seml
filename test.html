<!DOCTYPE html>
<html>
<head>
<style>
textarea {
}
</style>
</head>
<body>


<h1>Solution Centric Notations (SCN)</h1>

<br>
<label for="grammar">grammar:</label>
<textarea id="grammar" name="a" rows="10" cols="70" placeholder="grammar" style="background-color:oldlace;">
Arithmetic {
  /* Python code emitter */
  
  Top = Exp
  
  Exp
    = AddExp

  AddExp
    = AddExp "+" MulExp  -- plus
    | AddExp "-" MulExp  -- minus
    | MulExp

  MulExp
    = MulExp "*" ExpExp  -- times
    | MulExp "/" ExpExp  -- divide
    | ExpExp

  ExpExp
    = PriExp "^" ExpExp  -- power
    | PriExp

  PriExp
    = "(" Exp ")"  -- paren
    | "+" PriExp   -- pos
    | "-" PriExp   -- neg
    | ident
    | number

  ident  (an identifier)
    = letter alnum*

  number  (a number)
    = digit* "." digit+  -- fract
    | digit+             -- whole
}
</textarea>

<!-- <br> -->
<!-- <label for="pythonsemantics">python semantics:</label> -->
<!-- <textarea id="pythonsemantics" rows="10" cols="70" placeholder="semantics" style="background-color:oldlace;"> -->

<!--   Top [e] = [[ -->
<!--     print(${e}); -->
<!--     ]] -->
<!--   Exp [e] = [[${e}]] -->
<!--   AddExp_plus [e1 op e2] = [[${e1}+${e2}]] -->
<!--   AddExp_minus [e1 op e2] = [[${e1}-${e2}]] -->
<!--   AddExp [e] = [[${e}]] -->
<!--   MulExp_times [e1 op e2] = [[${e1}*${e2}]] -->
<!--   MulExp_divide [e1 op e2] = [[${e1}/${e2}]] -->
<!--   MulExp [e] = [[${e}]] -->
<!--   ExpExp_power[p op e] = [[${p}^${e}]] -->
<!--   ExpExp [p] = [[${p}]] -->
<!--   PriExp_paren [lp p rp] = [[(${p})]] -->
<!--   PriExp_pos [sign p] = [[+${p}]] -->
<!--   PriExp_neg [sign p] = [[-${p}]] -->
<!--   PriExp [p] = [[${p}]] -->
<!--   ident [l @a] = [[${l}${a}]] -->
<!--   number_fract [@numerator dot @denominator] = [[${numerator}.${denominator}]] -->
<!--   number_whole [@n] = [[${n}]] -->
<!-- </textarea> -->
<!-- <br> -->
<!-- <label for="wasmsemantics">wasm semantics:</label> -->
<!-- <textarea id="wasmsemantics" rows="10" cols="70" placeholder="semantics" style="background-color:oldlace;"> -->
<!--   Top [e] =  -->
<!--   [[ -->
<!-- (module -->
<!--   (func $custom (param $x f64) (param $y f64) (result f64) -->
<!-- ${e}) -->
<!--   (export "custom" (func $custom)) -->
<!-- ) -->
<!--     ]] -->
<!--   Exp [e] = [[${e}]] -->
<!--   AddExp_plus [e1 op e2] = [[${e1}\n${e2}\nf64.add\n]] -->
<!--   AddExp_minus [e1 op e2] = [[${e1}\n${e2}\nf64.sub\n]] -->
<!--   AddExp [e] = [[${e}]] -->
<!--   MulExp_times [e1 op e2] = [[${e1}\n${e2}\nf64.mul\n]] -->
<!--   MulExp_divide [e1 op e2] = [[${e1}\n${e2}\nf64.div\n]] -->
<!--   MulExp [e] = [[${e}]] -->
<!--   ExpExp_power[p op e] = [[(???exp ${p} ${e})]] -->
<!--   ExpExp [p] = [[${p}]] -->
<!--   PriExp_paren [lp p rp] = [[${p}]] -->
<!--   PriExp_pos [sign p] = [[${p}]] -->
<!--   PriExp_neg [sign p] = [[${p}\nf64.neg]] -->
<!--   PriExp [p] = [[${p}]] -->
<!--   ident [l @a] = [[local.get \$${l}${a}]] -->
<!--   number_fract [@numerator dot @denominator] = [[f64.const ${numerator}.${denominator}]] -->
<!--   number_whole [@n] = [[f64.const ${n}]] -->
<!-- </textarea> -->
<!-- <br> -->
<label for="semantics">semantics:</label>
<textarea id="semantics" rows="10" cols="70" placeholder="semantics" style="background-color:oldlace;">

  Top [e] = [[
    print(${e});
    ]]
  Exp [e] = [[${e}]]
  AddExp_plus [e1 op e2] = [[${e1}+${e2}]]
  AddExp_minus [e1 op e2] = [[${e1}-${e2}]]
  AddExp [e] = [[${e}]]
  MulExp_times [e1 op e2] = [[${e1}*${e2}]]
  MulExp_divide [e1 op e2] = [[${e1}/${e2}]]
  MulExp [e] = [[${e}]]
  ExpExp_power[p op e] = [[${p}^${e}]]
  ExpExp [p] = [[${p}]]
  PriExp_paren [lp p rp] = [[(${p})]]
  PriExp_pos [sign p] = [[+${p}]]
  PriExp_neg [sign p] = [[-${p}]]
  PriExp [p] = [[${p}]]
  ident [l @a] = [[${l}${a}]]
  number_fract [@numerator dot @denominator] = [[${numerator}.${denominator}]]
  number_whole [@n] = [[${n}]]
</textarea>

<!-- <br> -->
<!-- <label for="generatedSemantics">generated semantics:</label> -->
<!-- <textarea id="generatedSemantics" name="generatedSemantics" rows="10" cols="70" placeholder="Generated JS code" readonly style="background-color:whitesmoke;"> -->
<!-- </textarea> -->

<br>
<label for="source">source</label>
<textarea id="source" name="source" rows="10" cols="70" placeholder="notation test" style="background-color:oldlace;">
2+3
</textarea>

<label for="transpiled">transpiled</label>
<textarea id="transpiled" name="transpiled" rows="10" cols="70" placeholder="transpiled"  readonly style="background-color:whitesmoke;">
</textarea>
<br>
<br>
<p id="status" > READY </p>
<!-- </textarea> -->
<!-- <label for="status">status</label> -->
<!-- <textarea id="status" name="status" rows="10" cols="70" placeholder="status"> -->
<!-- </textarea> -->

<!-- see https://stackoverflow.com/questions/1880198/how-to-execute-shell-command-in-javascript -->
<br>
<button onclick="generate ()">Generate</button>
<script src="ohm.js"></script>
<script src="glue.js"></script>
<script src="scope.js"></script>
<script id='generated'></script>
<script>

function compile_and_run(text){
    console.log(text);
    //return eval('"use strict"; ' + text );
    return eval('' + text + '"OK"');
}

  function generate () {
      let notationSource = document.getElementById('source').value;
      let scnGrammar = document.getElementById('grammar').value;
      let semantics = document.getElementById('semantics').value;
      let generatedSCNSemantics = transpiler (semantics, glueGrammar, "_glue", glueSemantics);
      // document.getElementById('generatedSemantics').value = generatedSCNSemantics;

      _ruleInit();
      try {
	  document.getElementById('status').innerHTML = "FAILED";
	  //document.getElementById("transpiled").value = '{"a":"1","b":"2"}';
	  //document.getElementById ("transpiled").value = eval('({ Top_level : function xyz (_e) { _ruleEnter ("Top_level");	var e = _e._glue (); var _result = `${e}`; _ruleExit ("Top_level"); return _result; }})');
	  let semObject = eval('(' + generatedSCNSemantics + ')');
	  document.getElementById ("transpiled").value = semObject;
	  let tr = transpiler(notationSource, scnGrammar, "_glue", semObject);
	  document.getElementById('transpiled').value = tr;
	  document.getElementById('status').innerHTML = "OK";
      }
       catch (err) {
	  document.getElementById('status').innerHTML = err;
       }	   
  }
  </script>
</body>
</html>

